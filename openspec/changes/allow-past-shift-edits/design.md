# 设计：过去班次编辑与审计日志标记

## 背景
需要允许在日/周视图补录与修正历史班次，同时在审计日志中区分“操作发生时该班次已是过去”的写操作。要求不改动后端数据结构。

## 目标 / 非目标
- 目标
  - 日/周视图允许对过去班次进行创建、更新、删除
  - 审计日志前台标记过去班次相关操作
  - 月视图保持只读、列表仍只展示当前与未来
- 非目标
  - 变更审计日志或班次接口结构
  - 新增后端查询能力

## 决策
- 过去判定基准
  - 审计日志使用 occurred_at 作为“操作时间”基准
  - 日/周视图编辑能力不再受“过去时间段只读”限制
- 标记规则
  - shifts.delete：始终显著标记
  - shifts.create / shifts.update：当 start_at 或 end_at 早于 occurred_at 时标记
- 实现边界
  - 仅前端判断与展示，不引入后端字段或接口

## 备选方案
- 后端在审计日志记录中加入 start_at/end_at 或是否为过去的标记
- 增加 /shifts/:id 查询接口，前端无需额外范围拉取

## 风险与权衡
- 标记判定可能依赖额外班次数据加载；如果数据不可得，可能需要在 UI 中提示判定不完整
- 允许过去编辑会影响对“已发生班次”的理解，需要在审计日志中强化区分

## 迁移计划
无需数据迁移；仅更新前端行为与展示逻辑。

## 开放问题
无。
