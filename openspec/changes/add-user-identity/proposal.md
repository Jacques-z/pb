# Change: 引入用户身份系统与审计日志

## Why
当前系统仅支持共享令牌鉴权，无法区分具体操作者，且人员与用户没有一致的身份体系。需要引入用户身份系统，以支持账号密码登录、管理员创建用户、操作留档，并保持人员与用户一一对应。

## What Changes
- 新增用户身份系统：用户名+密码登录并签发会话令牌
- 客户端登录与改密使用用户名盐的慢哈希，服务端二次加盐慢哈希存储
- 新增管理员用户管理：创建、更新、删除用户与重置密码
- 人员目录与用户一一对应（person_id = user_id）
- 班次与人员接口鉴权从共享令牌改为用户会话令牌
- 新增服务端审计日志，仅记录成功的写操作并包含操作者
- 客户端改为账号密码登录

## 范围
### 范围内
- 用户账号与人员目录一一对应
- 用户名+密码登录与会话令牌
- 管理员用户管理与密码重置
- 用户自助修改密码
- 客户端预哈希 + 服务端二次哈希存储
- 默认所有已认证用户均可管理任意班次（无权限隔离）
- 服务端审计日志仅记录成功的写操作

### 范围外
- 多角色/细粒度权限系统
- 自助注册与邮箱/短信找回密码
- 读操作审计与审计日志的查询/导出界面
- 复杂密码策略（仅做最小校验）

## 成功标准
- 用户可使用账号密码登录并访问受保护接口
- 管理员可创建/重置用户，人员目录同步更新
- 任意已认证用户可修改他人班次
- 成功的写操作均产生包含操作者的审计日志
- 密码不以明文或客户端哈希形式持久化

## 风险
- 密码与会话安全需要最小可用但可靠的实现
- 客户端哈希可重放，依赖 TLS 保障传输安全
- 审计日志存储可能持续增长
- 现有人员数据需与用户账号对齐

## 规格大纲
- user-auth（新增）：登录、令牌、用户自助改密
- manage-users（新增）：管理员用户管理与重置密码
- audit-logs（新增）：操作日志记录
- manage-people（修改）：人员目录由用户系统驱动
- manage-shifts（修改）：鉴权方式与权限范围
- view-upcoming-shifts（修改）：客户端登录方式调整
