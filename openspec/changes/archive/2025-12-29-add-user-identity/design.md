## Context
- 现有系统仅有共享令牌，无法区分操作者
- 需要引入账号密码登录与用户管理
- 人员与用户需一一对应，避免双重数据源
- 所有操作需要服务端留档

## Goals / Non-Goals
- Goals:
  - 用户名+密码登录并签发会话令牌
  - 管理员可创建/更新/删除用户与重置密码
  - 用户可自助修改密码
  - 人员目录与用户一一对应
  - 所有 API 操作记录审计日志
  - 已认证用户可管理任意班次
- Non-Goals:
  - 多角色/细粒度权限
  - 自助注册、找回密码、外部 IdP
  - 客户端查看/导出审计日志

## Decisions
- Decision: 使用用户名+密码登录，并签发会话令牌用于鉴权
- Decision: 引入管理员标识（单一 is_admin），仅管理员可管理用户与重置密码
- Decision: 用户与人员一一对应，人员 ID 与用户 ID 保持一致
- Decision: 班次管理不做用户隔离，所有已认证用户均可操作
- Decision: 审计日志记录所有 API 请求，服务端持久化，不对客户端暴露
- Decision: 用户名不可修改，避免破坏客户端哈希规则
- Decision: 客户端对密码使用“用户名作盐的慢哈希”后提交；服务端对该值再加随机盐慢哈希存储
- Decision: 审计日志仅记录成功的写操作，不记录读取与失败请求

## Alternatives considered
- 继续使用共享令牌（无法记录操作者，拒绝）
- 多角色/细粒度权限（需求未提出，暂不引入）
- OAuth/外部身份提供方（超出最小实现）

## Risks / Trade-offs
- 密码与会话需要安全存储与验证
- 审计日志持续增长可能影响存储
- 现有人员数据需要与用户账号对齐
- 客户端哈希可重放，依赖 TLS 与令牌过期策略降低风险
- 仅记录写操作会降低问题排查的可追溯性

## Migration Plan
- 新增管理员账号初始化流程
- 将现有人员记录映射为用户记录（补齐用户名与初始密码）
- 验证人员目录与班次关联一致性

## Open Questions
- 无
